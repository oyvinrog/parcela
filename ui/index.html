<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parcela Vault</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="app">
      <header class="topbar">
        <div class="brand">
          <div class="logo">Parcela</div>
          <div class="tag">2-of-3 shared vault</div>
        </div>
        <div class="topbar-meta">
          <div id="status-msg" class="status">Ready.</div>
          <div id="app-version" class="app-version">v‚Äî</div>
        </div>
      </header>

      <main>
        <section id="login-screen" class="login-screen">
          <div class="login-card">
            <div class="login-header">
              <h1>Vault Login</h1>
              <p>One password unlocks the vault and encrypts every file inside.</p>
            </div>

            <div class="field">
              <label>Vault password</label>
              <input id="vault-password" type="password" placeholder="Enter passphrase" autofocus />
            </div>

            <div class="login-actions">
              <button id="open-vault" class="primary large">Open Vault</button>
              <button id="create-vault" class="secondary large">Create New Vault</button>
            </div>

            <div class="recent-vaults hidden" id="recent-vaults">
              <div class="recent-title">Recent vaults</div>
              <div class="recent-list" id="recent-vault-list"></div>
            </div>
          </div>
        </section>

        <section id="vault-screen" class="vault-screen hidden">
          <aside class="sidebar">
            <div class="vault-meta">
              <div class="vault-name" id="vault-name">Vault</div>
              <div class="vault-path" id="vault-current-path"></div>
              <div class="vault-security-badge" id="vault-security-badge">
                <span class="badge-icon"></span>
                <span class="badge-text"></span>
              </div>
            </div>
            <div class="vault-actions">
              <button id="add-virtual-drive" class="primary">Create Virtual Drive</button>
            </div>
            <div class="selection-controls">
              <label class="select-all">
                <input id="select-all-files" type="checkbox" />
                <span>Select all</span>
              </label>
              <button id="recover-selected">Recover selected</button>
            </div>
            <div class="file-list" id="file-list"></div>
          </aside>

          <section class="detail">
            <div id="detail-empty" class="detail-empty">
              <h2>Select a file</h2>
              <p>Choose a vault file to view share locations and recover it.</p>
            </div>

            <div id="detail-panel" class="detail-panel hidden">
              <div class="detail-header">
                <div>
                  <div class="kicker">Vault file</div>
                  <h2 id="detail-title">File</h2>
                </div>
                <div class="status-block">
                  <div class="lights-inline" id="detail-lights">
                    <span class="light" data-share="1" aria-hidden="true"></span>
                    <span class="light" data-share="2" aria-hidden="true"></span>
                    <span class="light" data-share="3" aria-hidden="true"></span>
                  </div>
                  <div class="share-count" id="detail-count"></div>
                </div>
              </div>

              <div class="share-list" id="share-list"></div>

              <div class="detail-actions" id="file-actions">
                <button id="recover-file" class="primary">Recover file</button>
              </div>

              <div class="detail-actions hidden" id="drive-actions">
                <button id="unlock-drive" class="primary">Unlock Drive</button>
                <button id="lock-drive" class="primary">Lock Drive</button>
                <button id="open-drive">Open in Browser</button>
              </div>

              <div class="drive-status hidden" id="drive-status">
                <div class="drive-status-label">Mount Path:</div>
                <div class="drive-status-path" id="drive-mount-path"></div>
              </div>

              <!-- File Browser for unlocked virtual drives -->
              <div class="file-browser hidden" id="file-browser">
                <div class="file-browser-header">
                  <div class="file-browser-title">
                    <span class="file-browser-icon">üìÇ</span>
                    <span>Drive Contents</span>
                  </div>
                  <div class="file-browser-actions">
                    <button id="fb-upload" class="fb-btn" title="Import file from disk">
                      <span>‚Üë</span> Import
                    </button>
                    <button id="fb-new-folder" class="fb-btn" title="Create new folder">
                      <span>+</span> New Folder
                    </button>
                  </div>
                </div>
                
                <div class="file-browser-breadcrumb" id="fb-breadcrumb">
                  <button class="breadcrumb-item" data-path="">üè† Root</button>
                </div>
                
                <div class="file-browser-list" id="fb-list">
                  <div class="fb-empty">Drive is empty. Import files to get started.</div>
                </div>
                
                <div class="file-browser-selection hidden" id="fb-selection">
                  <span id="fb-selected-name"></span>
                  <div class="fb-selection-actions">
                    <button id="fb-download" class="fb-btn primary" title="Export to disk">
                      <span>‚Üì</span> Export
                    </button>
                    <button id="fb-delete" class="fb-btn danger" title="Delete">
                      <span>√ó</span> Delete
                    </button>
                  </div>
                </div>
              </div>

              <div class="result" id="detail-result"></div>
            </div>
          </section>
        </section>
      </main>
    </div>

    <!-- Loading overlay for crypto operations -->
    <div id="loading-overlay" class="loading-overlay hidden">
      <div class="loading-card">
        <div class="loading-spinner"></div>
        <div class="loading-title" id="loading-title">Deriving encryption key‚Ä¶</div>
        <div class="loading-subtitle">This uses Argon2id with high-security parameters.</div>
      </div>
    </div>

    <!-- Security Verification Dialog -->
    <div id="security-dialog" class="modal-overlay hidden">
      <div class="security-dialog">
        <div class="security-dialog-header">
          <h2>üîê Security Verification</h2>
          <button id="security-dialog-close" class="dialog-close">√ó</button>
        </div>
        <div class="security-vault-info" id="security-vault-info">
          <div class="security-vault-name" id="security-vault-name">Vault</div>
          <div class="security-vault-path" id="security-vault-path"></div>
        </div>
        <div class="security-last-check hidden" id="security-last-check">
          <div class="security-last-check-content" id="security-last-check-content"></div>
        </div>
        <p class="security-dialog-desc">
          Running academic security attacks against your vault to verify cryptographic integrity.
        </p>
        <div class="security-tests" id="security-tests">
          <!-- Tests will be populated by JavaScript -->
        </div>
        <div class="security-summary hidden" id="security-summary">
          <div class="security-summary-icon" id="security-summary-icon"></div>
          <div class="security-summary-text" id="security-summary-text"></div>
        </div>
        <div class="security-dialog-actions">
          <button id="security-run-tests" class="primary">Run Security Tests</button>
          <button id="security-dialog-dismiss">Close</button>
        </div>
      </div>
    </div>

    <script src="main.js"></script>
  </body>
</html>
